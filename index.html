<!DOCTYPE html>
<html lang="en">

<?php include "index.php";?>

<head>
  <meta charset="utf-8">
 
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css"> 

   <title>Train Scheduler</title>

 <!--  <link rel="stylesheet" href="../assets/css/font-awesome.min.css"> -->
 <link rel="stylesheet" type="text/css" href="assets/reset.css">
 <link rel="stylesheet" type="text/css" href="assets/style.css">
</head>

<body>

<script src="https://use.fontawesome.com/7b6dd2ca46.js"></script>
 
<div class="container">
    <div class="jumbotron">
   <h1>Anytime is Train Time</h1> 
   <h4>Choo Choo. Chee Chee.</h4></div>

<div class="container" id="rContainer">
   <div class="row">
      <div class="panel panel-default">
        <div class="panel-heading" id="searchpar">
          Current Train Schedule
        </div>
        <div class="panel-body">
            <table class="table">
              <thead class="thead-inverse">
                <tr>
                <th class='col-md-3 bd'>Train Name</th>
                <th class='col-md-3 bd'>Destination</th>
                <th class='col-md-2'>Frequency (min)</th>
                <th class='col-md-2'>Next Arrival</th>
                <th class='col-md-2'>Minutes Away</th>
              </tr>
            </thead>
            <tbody id="display">
            
    <!-- all the <th> contents that are generated below go in here--> 
              
            </tbody>
          </table>
        </div>
      </div>
  
    </div>
  </div>

     
<div class="container" >
   <div class="row">
      <div class="panel panel-default">
        <div class="panel-heading" id="searchpar">
          Add Train
        </div>
        <div class="panel-body">
        <form id="formId">
          <div class="form-group">
            <label for="tname">Train Name:</label>
            <input type="name" class="form-control" id="tname" placeholder="Train Name">
            <div id="tnameAlert" class="alert alert-danger fade in">
              <strong>Warning! </strong> The train name cannot be blank!
            </div>
          </div>
          <div class="form-group">
            <label for="dest">Destination:</label>
            <!-- <input type="text" class="form-control" id="numRecords" placeholder="5"> -->
             <input type="name" class="form-control" id="keyword" placeholder="Keyword">
             <div id="destAlert" class="alert alert-danger fade in">
                <strong>Warning! </strong> The train name cannot be blank!
            </div>
          </div>

          <div class="form-group">
            <label for="FirstTrain">First Train Time (HH:mm - military time):</label>
            <input type="name" class="form-control" id="first" >
           
          <div id="firstAlert" class="alert alert-danger fade in">
          <strong>Warning!</strong> First Train cannot be null!
          </div>
          </div>

          <div class="form-group">
            <label for="freq">Frequency (min):</label>
            <input type="number" class="form-control" id="freq" min="1">
            <div id="freqAlert" class="alert alert-danger fade in">
              <strong>Warning!</strong> Frequency cannpt be null!
            </div>
          </div>
        </form>
        <button type="submit" class="btn" id="frmSubmit" id="test">
        <span class="glyphicon glyphicon-search" aria-hidden="true"></span>
        Search
        </button>  
        </div>
      </div>
    </div>
  </div>
</div>


  
  <!-- Displaying the results -->
<script src="https://code.jquery.com/jquery.js"></script>
 <!-- Latest compiled and minified JavaScript -->
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
<script src="https://www.gstatic.com/firebasejs/live/3.0/firebase.js"></script>
 <script type="text/javascript">


// Initialize Firebase
      var config = {
        apiKey: "AIzaSyAQQI1Bj44eLLLun92dvmUQQuJgtPmipFY",
        authDomain: "trainscheduler-91bf6.firebaseapp.com",
        databaseURL: "https://trainscheduler-91bf6.firebaseio.com",
        storageBucket: "trainscheduler-91bf6.appspot.com",
        messagingSenderId: "593113604347"
      };

    firebase.initializeApp(config);
    var dataRef = firebase.database();


  $("#frmSubmit").on("click", function(event) {

    event.preventDefault();
    $("#startDateAlert").hide();
    $("#endDateAlert").hide();
    $("#keywordAlert").hide();

    var queryUrl = "https://api.nytimes.com/svc/search/v2/articlesearch.json";
    var q = ($("#keyword").val()).trim();
    var begin_date = ($("#startDate").val()).trim();
    var end_date = ($("#endDate").val()).trim();
    var page = ($("#numRecords").val()).trim();

     if (q!=""){
          $("#keywordAlert").hide();
      }else{
          $("#keywordAlert").show();
          return;
      }
    
    queryUrl += '?' + $.param({
      'api-key': "05dd5e0a5d1841718337d9de569ceb6c",
      'q':  q,
      // 'page': page,
      'hl': "true",
      //'sort': "newest",
      'facet_field': "source",
      'facet_filter': "true"
    });
     
    

    // Add date only if the user inputs the date
    if(begin_date != ""){
        if(parseInt(begin_date) >= 1850 && parseInt(begin_date) < 2017){
            queryUrl += '&begin_date='+ begin_date + '0101';        
        }else{
              $("#startDateAlert").show();
              return;
        }
      
    }
    if(end_date != ""){
      if(parseInt(end_date) >= 1850 && parseInt(end_date) < 2017){
          queryUrl += '&end_date='+ end_date + '1231';
        
        }else{
            $("#endDateAlert").show();
            return;
        }
    }
       dispAjaxData(queryUrl, page);
      
      });

  /*
    Run the ajax query and display the results in the search panel
  */
 dataRef.ref().on("child_added", function(childSnapshot) {
      // Log everything that's coming out of snapshot
      console.log(childSnapshot.val().name);
      console.log(childSnapshot.val().email);
      console.log(childSnapshot.val().age);
      console.log(childSnapshot.val().comment);
      console.log(childSnapshot.val().joinDate);
      // full list of items to the well
      /*$("#full-member-list").append("<div class='well'><span id='name'> " + childSnapshot.val().name +
        " </span><span id='email'> " + childSnapshot.val().email +
        " </span><span id='age'> " + childSnapshot.val().age +
        " </span><span id='comment'> " + childSnapshot.val().comment + " </span></div>");*/
        newsDiv = $("<tr class='item'>");
        newsDiv.append("<td>" + childSnapshot.val().name + "</td>");
        newsDiv.append("<td>" + childSnapshot.val().email + "</td>");
        newsDiv.append("<td>" + childSnapshot.val().joinDate + "</td>");
        newsDiv.append("<td>" + childSnapshot.val().name + "</td>");
        newsDiv.append("<td>" + childSnapshot.val().email + "</td>");
        $(".table tbody").prepend(newsDiv);
    // Handle the errors
    }, function(errorObject) {
      console.log("Errors handled: " + errorObject.code);
    });


  $("#clr").on("click", function(event) {
        event.preventDefault();
       $("#formId")[0].reset();
        $("#display").empty();
  });

 

</script>

</body>
</html>












 
 